<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="underscore源码分析系列," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="前言这是underscore.js源码分析的第六篇，如果你对这个系列感兴趣，欢迎点击
underscore-analysis/ watch一下，随时可以看到动态更新。

下划线中有非常多很有趣的方法，可以用比较巧妙的方式解决我们日常生活中遇到的问题，比如_.after,_.before，_.defer…等，也许你已经用过他们了，今天我们来深入源码，一探究竟，他们到底是怎么实现的。">
<meta property="og:type" content="article">
<meta property="og:title" content="你要看看这些有趣的函数方法吗？">
<meta property="og:url" content="https://qianlongo.github.io/2017/05/25/这些有趣的函数方法你用过几个/index.html">
<meta property="og:site_name" content="谦龙的小天地">
<meta property="og:description" content="前言这是underscore.js源码分析的第六篇，如果你对这个系列感兴趣，欢迎点击
underscore-analysis/ watch一下，随时可以看到动态更新。

下划线中有非常多很有趣的方法，可以用比较巧妙的方式解决我们日常生活中遇到的问题，比如_.after,_.before，_.defer…等，也许你已经用过他们了，今天我们来深入源码，一探究竟，他们到底是怎么实现的。">
<meta property="og:image" content="http://odssgnnpf.bkt.clouddn.com/ppt-on-functions-3-728.jpg">
<meta property="og:image" content="http://odssgnnpf.bkt.clouddn.com/QQ20170525-220029@2x.png">
<meta property="og:image" content="http://odssgnnpf.bkt.clouddn.com/QQ20170526-001211@2x.png">
<meta property="og:updated_time" content="2017-05-25T16:55:13.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="你要看看这些有趣的函数方法吗？">
<meta name="twitter:description" content="前言这是underscore.js源码分析的第六篇，如果你对这个系列感兴趣，欢迎点击
underscore-analysis/ watch一下，随时可以看到动态更新。

下划线中有非常多很有趣的方法，可以用比较巧妙的方式解决我们日常生活中遇到的问题，比如_.after,_.before，_.defer…等，也许你已经用过他们了，今天我们来深入源码，一探究竟，他们到底是怎么实现的。">
<meta name="twitter:image" content="http://odssgnnpf.bkt.clouddn.com/ppt-on-functions-3-728.jpg">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="https://qianlongo.github.io/2017/05/25/这些有趣的函数方法你用过几个/"/>

  <title> 你要看看这些有趣的函数方法吗？ | 谦龙的小天地 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?06bde654070024b7b126d3d6286e6a8a";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  
  <!-- 设置背景canvas -->
  <div id="particles"></div>

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">谦龙的小天地</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">因上努力 果上随缘</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input" placeholder="输入关键字搜索您希望看的文章内容">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                你要看看这些有趣的函数方法吗？
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-05-25T21:34:32+08:00" content="2017-05-25">
              2017-05-25
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/05/25/这些有趣的函数方法你用过几个/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/05/25/这些有趣的函数方法你用过几个/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/05/25/这些有趣的函数方法你用过几个/" class="leancloud_visitors" data-flag-title="你要看看这些有趣的函数方法吗？">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这是underscore.js源码分析的第六篇，如果你对这个系列感兴趣，欢迎点击</p>
<p><a href="https://github.com/qianlongo/underscore-analysis/" target="_blank" rel="external">underscore-analysis/</a> watch一下，随时可以看到动态更新。</p>
<blockquote>
<p>下划线中有非常多很有趣的方法，可以用比较巧妙的方式解决我们日常生活中遇到的问题，比如<code>_.after</code>,<code>_.before</code>，<code>_.defer</code>…等，也许你已经用过他们了，今天我们来深入源码，一探究竟，他们到底是怎么实现的。</p>
</blockquote>
<p><img src="http://odssgnnpf.bkt.clouddn.com/ppt-on-functions-3-728.jpg" alt="function"></p>
<a id="more"></a>
<h2 id="指定调用次数-after-before"><a href="#指定调用次数-after-before" class="headerlink" title="指定调用次数(after, before)"></a>指定调用次数(<code>after</code>, <code>before</code>)</h2><blockquote>
<p>把这两个方法放在前面也是因为他们俩能够解决我们工作中至少以下两个问题</p>
</blockquote>
<ol>
<li><p>如果你要等多个异步请求完成之后才去执行某个操作<code>fn</code>,那么你可以用<code>_.after</code>，而不必写多层异步回调地狱去实现需求</p>
</li>
<li><p>有一些应用可能需要进行初始化操作而且仅需要一次初始化就可以，一般的做法是在入口处对某个变量进行判断，如果为真那么认为已经初始化过了直接<code>return</code>掉，如果为假那么进行参数的初始化工作，并在完成初始化之后设置该变量为真，那么下次进入的时候便不必重复初始化了。</p>
</li>
</ol>
<p><strong>对于问题1</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">let</span> async1 = <span class="function">(<span class="params">cb</span>) =&gt;</span> &#123;</div><div class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'异步任务1结束了'</span>)</div><div class="line">    cb()</div><div class="line">  &#125;, <span class="number">1000</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> async2 = <span class="function">(<span class="params">cb</span>) =&gt;</span> &#123;</div><div class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'异步任务2结束了'</span>)</div><div class="line">    cb()</div><div class="line">  &#125;, <span class="number">2000</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> fn = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'我是两个任务都结束了才进行的任务'</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果要在任务1，和任务2都结束了才进行<code>fn</code>任务，我们一般的写法是啥？<br>可能会下面这样写</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">async1(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  async2(fn)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>这样确实可以保证任务<code>fn</code>是在前面两个异步任务都结束之后才进行，但是相信你是不太喜欢回调的写法的，这里举的异步任务只有两个，如果多了起来，恐怕就要蛋疼了。别疼，用下划线的<code>after</code>函数可以解救你。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">fn = _.after(<span class="number">2</span>, fn)</div><div class="line"></div><div class="line">async1(fn)</div><div class="line">async2(fn)</div></pre></td></tr></table></figure>
<p><strong>运行截图</strong></p>
<p><img src="http://odssgnnpf.bkt.clouddn.com/QQ20170525-220029@2x.png" alt="after举例"></p>
<p>有木有很爽，不用写成回调地狱的形式了。那么接下来我们看看源码是怎么实现的。</p>
<p><strong>after源码实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">_.after = <span class="function"><span class="keyword">function</span>(<span class="params">times, func</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// 只有返回的函数被调用times次之后才执行func操作</span></div><div class="line">    <span class="keyword">if</span> (--times &lt; <span class="number">1</span>) &#123;</div><div class="line">      <span class="keyword">return</span> func.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>源码简单到要死啊，但是就是这么神奇，妥妥地解决了我们的问题1。</p>
<p><strong>对于问题2</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">let</span> app = &#123;</div><div class="line">  init (name, sex) &#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.initialized) &#123;</div><div class="line">      <span class="keyword">return</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 进行参数的初始化工作</span></div><div class="line">    <span class="keyword">this</span>.name = name</div><div class="line">    <span class="keyword">this</span>.sex = sex</div><div class="line">    <span class="comment">// 初始化完成，设置标志</span></div><div class="line">    <span class="keyword">this</span>.initialized = <span class="literal">true</span></div><div class="line">  &#125;,</div><div class="line">  showInfo () &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name, <span class="keyword">this</span>.sex)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 传参数进行应用的初始化</span></div><div class="line"></div><div class="line">app.init(<span class="string">'qianlonog'</span>, <span class="string">'boy'</span>)</div><div class="line">app.init(<span class="string">'xiaohuihui'</span>, <span class="string">'girl'</span>)</div><div class="line">app.showInfo() <span class="comment">// qianlonog boy 注意这里打印出来的是第一次传入的参数</span></div></pre></td></tr></table></figure>
<p>一般需要且只进行一次参数初始化工作的时候,我们可能会像上面那样做。但是其实如果用下划线中的<code>before</code>方法我们还可以这样做。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> app = &#123;</div><div class="line">  <span class="attr">init</span>: _.before(<span class="number">2</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name, sex</span>) </span>&#123;</div><div class="line">    <span class="comment">// 进行参数的初始化工作</span></div><div class="line">    <span class="keyword">this</span>.name = name</div><div class="line">    <span class="keyword">this</span>.sex = sex</div><div class="line">  &#125;) ,</div><div class="line">  showInfo () &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name, <span class="keyword">this</span>.sex)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 传参数进行应用的初始化</span></div><div class="line"></div><div class="line">app.init(<span class="string">'qianlonog'</span>, <span class="string">'boy'</span>)</div><div class="line">app.init(<span class="string">'xiaohuihui'</span>, <span class="string">'girl'</span>)</div><div class="line">app.showInfo() <span class="comment">// qianlonog boy 注意这里打印出来的是第一次传入的参数</span></div></pre></td></tr></table></figure>
<p>好玩吧，让我们看看<code>_.before</code>是怎么实现的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// 创建一个函数，这个函数调用次数不超过times次</span></div><div class="line"><span class="comment">// 如果次数 &gt;= times 则最后一次调用函数的返回值将被记住并一直返回该值</span></div><div class="line"></div><div class="line">_.before = <span class="function"><span class="keyword">function</span>(<span class="params">times, func</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> memo;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// 返回的函数每次调用都times减1</span></div><div class="line">    <span class="keyword">if</span> (--times &gt; <span class="number">0</span>) &#123; </div><div class="line">      <span class="comment">// 调用func，并传入外面传进来的参数</span></div><div class="line">      <span class="comment">// 需要注意的是，后一次调用的返回值会覆盖前一次</span></div><div class="line">      memo = func.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 当调用次数够了，就将func销毁设置为null</span></div><div class="line">    <span class="keyword">if</span> (times &lt;= <span class="number">1</span>) func = <span class="literal">null</span>;</div><div class="line">    <span class="keyword">return</span> memo;</div><div class="line">  &#125;;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="让函数具有记忆的功能"><a href="#让函数具有记忆的功能" class="headerlink" title="让函数具有记忆的功能"></a>让函数具有记忆的功能</h2><blockquote>
<p>在程序中我们经常会要进行一些计算的操作，当遇到比较耗时的操作时候，如果有一种机制，对于同样的输入，一定得到相同的输出，并且对于同样的输入，后续的计算直接从缓存中读取，不再需要将计算程序运行那就非常赞了。</p>
</blockquote>
<p><strong>举例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">let</span> calculate = <span class="function">(<span class="params">num, num2</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">let</span> result = <span class="number">0</span></div><div class="line">  <span class="keyword">let</span> start = <span class="built_in">Date</span>.now()</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i&lt; <span class="number">10000000</span>; i++) &#123; <span class="comment">// 这里只是模拟耗时的操作</span></div><div class="line">    result += num</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i&lt; <span class="number">10000000</span>; i++) &#123; <span class="comment">// 这里只是模拟耗时的操作</span></div><div class="line">    result += num2</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">let</span> end = <span class="built_in">Date</span>.now()</div><div class="line">  <span class="built_in">console</span>.log(end - start)</div><div class="line">  <span class="keyword">return</span> result</div><div class="line">&#125;</div><div class="line"></div><div class="line">calculate(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// 30000000</span></div><div class="line"><span class="comment">// log 得到235</span></div><div class="line">calculate(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// 30000000</span></div><div class="line"><span class="comment">// log 得到249</span></div></pre></td></tr></table></figure>
<p>对于上面这个calculate函数,同样的输入1, 2,两次调用的输出都是一样的，并且两次都走了两个耗时的循环，看看下划线中的<code>memoize</code>函数，如何为我们省去第二次的耗时操作，直接给出<code>300000</code>的返回值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> calculate = _.memoize(<span class="function">(<span class="params">num, num2</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">let</span> start = <span class="built_in">Date</span>.now()</div><div class="line">  <span class="keyword">let</span> result = <span class="number">0</span></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i&lt; <span class="number">10000000</span>; i++) &#123; <span class="comment">// 这里只是模拟耗时的操作</span></div><div class="line">    result += num</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i&lt; <span class="number">10000000</span>; i++) &#123; <span class="comment">// 这里只是模拟耗时的操作</span></div><div class="line">    result += num2</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">let</span> end = <span class="built_in">Date</span>.now()</div><div class="line">  <span class="built_in">console</span>.log(end - start)</div><div class="line">  <span class="keyword">return</span> result</div><div class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> [].join.call(<span class="built_in">arguments</span>, <span class="string">'@'</span>) <span class="comment">// 这里是为了给同样的输入指定唯一的缓存key</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line">calculate(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// 30000000</span></div><div class="line"><span class="comment">// log 得到 238</span></div><div class="line">calculate(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// 30000000</span></div><div class="line"><span class="comment">// log 啥也没有打印出，因为直接从缓存中读取了</span></div></pre></td></tr></table></figure>
<p><strong>源码实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"> _.memoize = <span class="function"><span class="keyword">function</span>(<span class="params">func, hasher</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> memoize = <span class="function"><span class="keyword">function</span>(<span class="params">key</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> cache = memoize.cache;</div><div class="line">    <span class="comment">// 注意hasher，如果传了hasher，就用hasher()执行的结果作为缓存func()执行的结果的key</span></div><div class="line">    <span class="keyword">var</span> address = <span class="string">''</span> + (hasher ? hasher.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>) : key); </div><div class="line">    <span class="comment">// 如果没有在cache中查找到对应的key就去计算一次，并缓存下来</span></div><div class="line">    <span class="keyword">if</span> (!_.has(cache, address)) cache[address] = func.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>); </div><div class="line">    <span class="comment">// 返回结果</span></div><div class="line">    <span class="keyword">return</span> cache[address];</div><div class="line">  &#125;;</div><div class="line">  memoize.cache = &#123;&#125;;</div><div class="line">  <span class="keyword">return</span> memoize; <span class="comment">// 返回一个具有cache静态属性的函数</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>相信你已经看懂了源码实现，是不是很简单，但是又很实用有趣。</p>
<h2 id="来一下延时-delay和-defer"><a href="#来一下延时-delay和-defer" class="headerlink" title="来一下延时(.delay和.defer)"></a>来一下延时(<em>.delay和</em>.defer)</h2><blockquote>
<p> 下划线中在原生延迟函数<code>setTimeout</code>的基础上做了一些改造，产生以上两个函数</p>
</blockquote>
<p><strong>_.delay(function, wait, *arguments)</strong></p>
<p>就是延迟<code>wait</code>时间去执行<code>function</code>，<code>function</code>需要的参数由<code>*arguments</code>提供</p>
<p><strong>使用举例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> log = _.bind(<span class="built_in">console</span>.log, <span class="built_in">console</span>)</div><div class="line">_.delay(log, <span class="number">1000</span>, <span class="string">'hello qianlongo'</span>)</div><div class="line"><span class="comment">// 1秒后打印出 hello qianlongo</span></div></pre></td></tr></table></figure>
<p><strong>源码实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">_.delay = <span class="function"><span class="keyword">function</span>(<span class="params">func, wait</span>) </span>&#123;</div><div class="line">  <span class="comment">// 读取第三个参数开始的其他参数</span></div><div class="line">  <span class="keyword">var</span> args = slice.call(<span class="built_in">arguments</span>, <span class="number">2</span>);</div><div class="line">  <span class="keyword">return</span> setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">// 执行func并将参数传入,注意apply的第一个参数是null护着undefined的时候，func内部的this指的是全局的window或者global</span></div><div class="line">    <span class="keyword">return</span> func.apply(<span class="literal">null</span>, args); </div><div class="line">  &#125;, wait);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>不过有点需要注意的是<code>_.delay(function, wait, *arguments)``function</code>中的<code>this</code>指的是<code>window</code>或者<code>global</code></p>
<p><strong>_.defer(function, *arguments)</strong></p>
<p>延迟调用function直到当前调用栈清空为止，类似使用延时为0的setTimeout方法。对于执行开销大的计算和无阻塞UI线程的HTML渲染时候非常有用。 如果传递arguments参数，当函数function执行时， arguments 会作为参数传入</p>
<p><strong>源码实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">_.defer = _.partial(_.delay, _, <span class="number">1</span>);</div></pre></td></tr></table></figure>
<p>所以主要还是看<code>_.partial</code>是个啥</p>
<h2 id="可以预指定参数的函数-partial"><a href="#可以预指定参数的函数-partial" class="headerlink" title="可以预指定参数的函数_.partial"></a>可以预指定参数的函数<code>_.partial</code></h2><blockquote>
<p>局部应用一个函数填充在任意个数的 参数，不改变其动态this值。和bind方法很相近。你可以在你的参数列表中传递_来指定一个参数 ，不应该被预先填充(<a href="http://www.bootcss.com/p/underscore/#partial" target="_blank" rel="external">underscore中文网翻译</a>)</p>
</blockquote>
<p><strong>使用举例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">let</span> fn = <span class="function">(<span class="params">num1, num2, num3, num4</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">let</span> str = <span class="string">`num1=<span class="subst">$&#123;num1&#125;</span>`</span></div><div class="line">  str += <span class="string">`num2=<span class="subst">$&#123;num2&#125;</span>`</span></div><div class="line">  str += <span class="string">`num3=<span class="subst">$&#123;num3&#125;</span>`</span></div><div class="line">  str += <span class="string">`num4=<span class="subst">$&#123;num4&#125;</span>`</span></div><div class="line">  <span class="keyword">return</span> str</div><div class="line">&#125;</div><div class="line"></div><div class="line">fn = _.partial(fn, <span class="number">1</span>, _, <span class="number">3</span>, _)</div><div class="line">fn(<span class="number">2</span>,<span class="number">4</span>)<span class="comment">// num1=1num2=2num3=3num4=4</span></div></pre></td></tr></table></figure>
<p>可以看到，我们传入了<code>_</code>(这里指的是下划线本身)进行占位，后续再讲2和4填充到对应的位置去了。</p>
<p><strong>源码具体怎么实现的呢？</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">_.partial = <span class="function"><span class="keyword">function</span>(<span class="params">func</span>) </span>&#123;</div><div class="line">  <span class="comment">// 获取除了传进回调函数之外的其他预参数</span></div><div class="line">  <span class="keyword">var</span> boundArgs = slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>); </div><div class="line">  <span class="keyword">var</span> bound = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> position = <span class="number">0</span>, length = boundArgs.length;</div><div class="line">    <span class="comment">// 先创建一个和boundArgs长度等长的空数组</span></div><div class="line">    <span class="keyword">var</span> args = <span class="built_in">Array</span>(length); </div><div class="line">    <span class="comment">// 处理占位元素_</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; length; i++) &#123; </div><div class="line">      <span class="comment">// 如果发现boundArgs中有_的占位元素，就依次用arguments中的元素进行替换boundArgs</span></div><div class="line">      args[i] = boundArgs[i] === _ ? <span class="built_in">arguments</span>[position++] : boundArgs[i]; </div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 把auguments中的其他元素添加到boundArgs中</span></div><div class="line">    <span class="keyword">while</span> (position &lt; <span class="built_in">arguments</span>.length) args.push(<span class="built_in">arguments</span>[position++]); </div><div class="line">    <span class="comment">// 最后执行executeBound，接下来看看executeBound是什么</span></div><div class="line">    <span class="keyword">return</span> executeBound(func, bound, <span class="keyword">this</span>, <span class="keyword">this</span>, args);</div><div class="line">  &#125;;</div><div class="line">  <span class="keyword">return</span> bound;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>在上一篇文章<a href="https://github.com/qianlongo/underscore-analysis/issues/8" target="_blank" rel="external">如何写一个实用的bind？</a><br>有详细讲解，这里我们再回顾一下<br><strong>executeBound</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> executeBound = <span class="function"><span class="keyword">function</span>(<span class="params">sourceFunc, boundFunc, context, callingContext, args</span>) </span>&#123;</div><div class="line">  <span class="comment">// 如果调用方式不是new func的形式就直接调用sourceFunc，并且给到对应的参数即可</span></div><div class="line">  <span class="keyword">if</span> (!(callingContext <span class="keyword">instanceof</span> boundFunc)) <span class="keyword">return</span> sourceFunc.apply(context, args); </div><div class="line">   <span class="comment">// 处理new调用的形式</span></div><div class="line">  <span class="keyword">var</span> self = baseCreate(sourceFunc.prototype);</div><div class="line">  <span class="keyword">var</span> result = sourceFunc.apply(self, args);</div><div class="line">  <span class="keyword">if</span> (_.isObject(result)) <span class="keyword">return</span> result;</div><div class="line">  <span class="keyword">return</span> self;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>先看一下这些参数都�代表什么含义</p>
<ol>
<li>sourceFunc：原函数，待绑定函数</li>
<li>boundFunc： 绑定后函数</li>
<li>context：绑定后函数this指向的上下文</li>
<li>callingContext：绑定后函数的执行上下文，通常就是 this</li>
<li>args：绑定后的函数执行所需参数</li>
</ol>
<p>这里其实就是执行了这句,所以关键还是如果处理预参数，和后续参数的逻辑</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sourceFunc.apply(context, args);</div></pre></td></tr></table></figure>
<h2 id="管道式函数组合"><a href="#管道式函数组合" class="headerlink" title="管道式函数组合"></a>管道式函数组合</h2><blockquote>
<p>你也许遇到过这种场景，任务A，任务B，任务C必须按照顺序执行，并且A的输出作为B的输入，B的输出作为C的输入，左后再得到结果。用一张图表示如下</p>
</blockquote>
<p><img src="http://odssgnnpf.bkt.clouddn.com/QQ20170526-001211@2x.png" alt="管道"></p>
<p>那么一般的做法是什么呢</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> funcA = <span class="function">(<span class="params">str</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> str += <span class="string">'-A'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> funcB = <span class="function">(<span class="params">str</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> str += <span class="string">'-B'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> funcC = <span class="function">(<span class="params">str</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> str += <span class="string">'-C'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">funcC(funcB(funcA(<span class="string">'hello'</span>)))</div><div class="line"><span class="comment">// "hello-A-B-C"</span></div><div class="line"></div><div class="line"><span class="string">``</span><span class="string">` javascript</span></div><div class="line">用下划线中的`compose<span class="string">`方法怎么做呢</span></div><div class="line"></div><div class="line">`<span class="string">``</span> javascript</div><div class="line"><span class="keyword">let</span> fn = _.compose(funcC, funcB, funcA)</div><div class="line">fn(<span class="string">'hello'</span>)</div><div class="line"><span class="comment">// "hello-A-B-C"</span></div></pre></td></tr></table></figure>
<p>看起来没有一般的做法那样，层层绕进去了，而是以一种非常扁平的方式使用。</p>
<p>同样我们看看源码是怎么实现的。</p>
<p><strong>_.compose源码</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">_.compose = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> args = <span class="built_in">arguments</span>;</div><div class="line">  <span class="comment">// 从最后一个参数开始处理</span></div><div class="line">  <span class="keyword">var</span> start = args.length - <span class="number">1</span>;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> i = start;</div><div class="line">    <span class="comment">// 执行最后一个函数,并得到结果result</span></div><div class="line">    <span class="keyword">var</span> result = args[start].apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>); </div><div class="line">    <span class="comment">// 从后往前一个个调用传进来的函数，并将上一次执行的结果作为参数传进下一个函数</span></div><div class="line">    <span class="keyword">while</span> (i--) result = args[i].call(<span class="keyword">this</span>, result); </div><div class="line">    <span class="comment">// 最后将结果导出</span></div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">  &#125;;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="给多个函数绑定同样的上下文-bindAll-object-methodNames"><a href="#给多个函数绑定同样的上下文-bindAll-object-methodNames" class="headerlink" title="给多个函数绑定同样的上下文(_.bindAll(object, *methodNames))"></a>给多个函数绑定同样的上下文<code>(_.bindAll(object, *methodNames))</code></h2><blockquote>
<p>将多个函数methodNames绑定上下文环境为<code>object</code></p>
</blockquote>
<p>😪 😪 😪，好困，写文章当真好要时间和精力，到这里已经快写了3个小时了，夜深，好像躺下睡觉啊！！！啊啊啊，再等等快说完了（希望不会误人子弟）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> buttonView = &#123;</div><div class="line">  <span class="attr">label</span>  : <span class="string">'underscore'</span>,</div><div class="line">  <span class="attr">onClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; alert(<span class="string">'clicked: '</span> + <span class="keyword">this</span>.label); &#125;,</div><div class="line">  <span class="attr">onHover</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="string">'hovering: '</span> + <span class="keyword">this</span>.label); &#125;</div><div class="line">&#125;;</div><div class="line">_.bindAll(buttonView, <span class="string">'onClick'</span>, <span class="string">'onHover'</span>);</div><div class="line"></div><div class="line">$(<span class="string">'#underscore_button'</span>).bind(<span class="string">'click'</span>, buttonView.onClick);</div></pre></td></tr></table></figure>
<p>我们用官网给的例子说一下，默认的jQuery中<code>$(selector).on(eventName, callback)</code>callback中的<code>this</code>指的是当前的元素本身，当时经过上面的处理，会弹出<code>underscore</code>。</p>
<p><strong>_.bindAll源码实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"> _.bindAll = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> i, length = <span class="built_in">arguments</span>.length, key;</div><div class="line">  <span class="comment">// 必须要指定需要绑定到obj的函数参数</span></div><div class="line">  <span class="keyword">if</span> (length &lt;= <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'bindAll must be passed function names'</span>);</div><div class="line">  <span class="comment">// 从第一个实参开始处理，这些便是需要绑定this作用域到obj的函数</span></div><div class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; length; i++) &#123; </div><div class="line">    key = <span class="built_in">arguments</span>[i];</div><div class="line">    <span class="comment">// 调用内部的bind方法进行this绑定</span></div><div class="line">    obj[key] = _.bind(obj[key], obj); </div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> obj;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>内部使用了<code>_.bind</code>进行绑定，如果你对<code>_.bind</code>原生是如何实现的可以看这里<a href="https://github.com/qianlongo/underscore-analysis/issues/8" target="_blank" rel="external">如何写一个实用的bind？</a></p>
<h2 id="拾遗"><a href="#拾遗" class="headerlink" title="拾遗"></a>拾遗</h2><blockquote>
<p>最后关于underscore.js中function篇章还有两个函数说一下，另外节流函数<code>throttle</code>以及<code>debounce_</code>会另外单独写一篇文章介绍，欢迎前往<a href="https://github.com/qianlongo/underscore-analysis/" target="_blank" rel="external">underscore-analysis/</a> watch一下，随时可以看到动态更新。</p>
</blockquote>
<p><strong>_.wrap(function, wrapper)</strong></p>
<p>将第一个函数 function 封装到函数 wrapper 里面, 并把函数 function 作为第一个参数传给 wrapper. 这样可以让 wrapper 在 function 运行之前和之后 执行代码, 调整参数然后附有条件地执行.</p>
<p><strong>直接看源码实现吧</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">_.wrap = <span class="function"><span class="keyword">function</span>(<span class="params">func, wrapper</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> _.partial(wrapper, func);</div><div class="line">  &#125;;</div></pre></td></tr></table></figure>
<p>还记得前面说的<code>partial</code>吧，他会返回一个函数，内部会执行<code>wrapper</code>，并且<code>func</code>会作为<code>wrapper</code>的一个参数被传入。</p>
<p><strong>_.negate(predicate)</strong></p>
<blockquote>
<p>将predicate函数执行的结果取反。</p>
</blockquote>
<p><strong>使用举例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">let</span> fn = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">_.negate(fn)() <span class="comment">// false</span></div></pre></td></tr></table></figure>
<p>看起来好像没什么软用，但是。。。。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</div><div class="line"></div><div class="line"><span class="keyword">let</span> findEven = <span class="function">(<span class="params">num</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> num % <span class="number">2</span> === <span class="number">0</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">arr.filter(findEven) <span class="comment">// [2, 4, 6]</span></div></pre></td></tr></table></figure>
<p>如果要找到奇数呢？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</div><div class="line"></div><div class="line"><span class="keyword">let</span> findEven = <span class="function">(<span class="params">num</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> num % <span class="number">2</span> === <span class="number">0</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">arr.filter(_.negate(findEven)) <span class="comment">// [1, 3, 5]</span></div></pre></td></tr></table></figure>
<p><strong>源码实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">_.negate = <span class="function"><span class="keyword">function</span>(<span class="params">predicate</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> !predicate.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">  &#125;;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>源码很简单，就是把你传进来的predicate函数执行的结果取反一下，但是应用还是蛮多的。</p>
<h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><blockquote>
<p>这几个是underscore库中function相关的api，大部分已经说完了，如果对你有一点点帮助。</p>
</blockquote>
<p><a href="https://github.com/qianlongo/underscore-analysis" target="_blank" rel="external">点一个小星星吧😀😀😀</a></p>
<p><a href="https://github.com/qianlongo/underscore-analysis" target="_blank" rel="external">点一个小星星吧😀😀😀</a></p>
<p><a href="https://github.com/qianlongo/underscore-analysis" target="_blank" rel="external">点一个小星星吧😀😀😀</a></p>
<p>good night 🌙</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/underscore源码分析系列/" rel="tag">#underscore源码分析系列</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/05/20/如何写一个实用的bind？/" rel="next" title="如何写一个实用的bind？">
                <i class="fa fa-chevron-left"></i> 如何写一个实用的bind？
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/06/05/mouseenter与mouseover为何这般纠缠不清？/" rel="prev" title="mouseenter与mouseover为何这般纠缠不清？">
                mouseenter与mouseover为何这般纠缠不清？ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <div class="ds-share flat" data-thread-key="2017/05/25/这些有趣的函数方法你用过几个/"
     data-title="你要看看这些有趣的函数方法吗？"
     data-content=""
     data-url="https://qianlongo.github.io/2017/05/25/这些有趣的函数方法你用过几个/">
  <div class="ds-share-inline">
    <ul  class="ds-share-icons-16">

      <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
      <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
      <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
      <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
      <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>

    </ul>
    <div class="ds-share-icons-more">
    </div>
  </div>
</div>
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2017/05/25/这些有趣的函数方法你用过几个/"
           data-title="你要看看这些有趣的函数方法吗？" data-url="https://qianlongo.github.io/2017/05/25/这些有趣的函数方法你用过几个/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://sfault-avatar.b0.upaiyun.com/893/290/893290401-5621cb66a2ed6_huge256"
               alt="谦龙" />
          <p class="site-author-name" itemprop="name">谦龙</p>
          <p class="site-description motion-element" itemprop="description">热爱生活，热爱编程，刚入门的一名前端小码农，在这里，写自己想说的话，读过的书，爱的人...</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">53</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/qianlongo" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/5607962277/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/qian-long-16-72" target="_blank" title="Zhihu">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Zhihu
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#指定调用次数-after-before"><span class="nav-number">2.</span> <span class="nav-text">指定调用次数(after, before)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#让函数具有记忆的功能"><span class="nav-number">3.</span> <span class="nav-text">让函数具有记忆的功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#来一下延时-delay和-defer"><span class="nav-number">4.</span> <span class="nav-text">来一下延时(.delay和.defer)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#可以预指定参数的函数-partial"><span class="nav-number">5.</span> <span class="nav-text">可以预指定参数的函数_.partial</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#管道式函数组合"><span class="nav-number">6.</span> <span class="nav-text">管道式函数组合</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#给多个函数绑定同样的上下文-bindAll-object-methodNames"><span class="nav-number">7.</span> <span class="nav-text">给多个函数绑定同样的上下文(_.bindAll(object, *methodNames))</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#拾遗"><span class="nav-number">8.</span> <span class="nav-text">拾遗</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#结尾"><span class="nav-number">9.</span> <span class="nav-text">结尾</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">谦龙</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"qianlongo"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });

    $(document).click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });

    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>
  <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("nnrLyBcuNRbOdTn45bzlEBC5-gzGzoHsz", "ru8RIcugE0RouivkbirObO9j");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

</body>
</html>
